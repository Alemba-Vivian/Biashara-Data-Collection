<div bsModal #createModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-success" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" role="document">
    <div class="modal-content">
      <div class="modal-header text-white site-bg-success m-0 p-2">
        <h6 class="modal-title">Request Travel</h6>
        <button type="button" class="close btn text-white site-btn-succes m-0 p-0" (click)="createModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="createRecordForm" >
          <div class="form-group mb-3">
            <label for="evidence" class="control-label fw-bold">
              Employee No 
            </label>
            <div class="employee_no">
              <input id="employee_no"  type="text" class="form-control" formControlName="employee_no">         
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="evidence" class="control-label fw-bold">
              Position Title 
            </label>
            <div class="position">
              <input id="position"  type="text" class="form-control" formControlName="position">         
            </div>
          </div>
          <div class="form-group mb-3">
            <label class="col-form-label fw-bold" for="purpose">Purpose of Travel</label>
            <div class="">
              <ng-select formControlName="purpose" placeholder="-- select below --">
                <ng-option value="Business">Business</ng-option>
                <ng-option value="Training">Training</ng-option>
                <ng-option value="Personal">Personal</ng-option>
              </ng-select>
            </div>
          </div>
          <div class="form-group mb-3">
            <label class="col-form-label fw-bold" for="input-small">Travel Description / Details</label>
            <div class="">
              <textarea rows="3"  class="form-control form-control-md" placeholder="Type here..."  formControlName="description" required ></textarea>
            </div>
          </div>
          <div class="form-group mb-3">
            <label class="col-form-label fw-bold" for="route">Travel Route</label>
            <div class="">
              <textarea rows="3"  class="form-control form-control-md" placeholder="Type here..."  formControlName="route" required ></textarea>
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="departure_date" class="control-label fw-bold">
              Departure Date 
            </label>
            <div class="position">
              <input id="departure_date"  type="date" class="form-control" formControlName="departure_date">         
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="return_date" class="control-label fw-bold">
              Return Date 
            </label>
            <div class="position">
              <input id="return_date"  type="date" class="form-control" formControlName="return_date">         
            </div>
          </div>
          
          <div class="form-group mb-3">
            <label class="col-form-label fw-bold" for="input-small">Hotel / Accommodation</label>
            <div class="">
              <ng-select formControlName="accommodation" placeholder="-- select below --">
                <ng-option value="true">Yes</ng-option>
                <ng-option value="false">No</ng-option>
              </ng-select>
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="visa_required_date" class="control-label fw-bold">
              Required Date of Visa. <mark>If Applicable</mark> 
            </label>
            <div class="position">
              <input id="visa_required_date"  type="date" class="form-control" formControlName="visa_required_date">         
            </div>
          </div>
          <div class="form-group mb-3">
            <label class="col-form-label fw-bold" for="salary_amount_required">Salary Advance Needed?</label>
            <div class="">
              <ng-select formControlName="salary_advance_required" placeholder="-- select below --" >
                <ng-option [value]="true">Yes</ng-option>
                <ng-option [value]="false">No</ng-option>
              </ng-select>
            </div>
          </div>
          <div class="form-group mb-3" *ngIf="createRecordForm?.value?.salary_advance_required">
            <label for="salary_amount_required" class="control-label fw-bold">
              Amount Required 
            </label>
            <div class="position">
              <input id="salary_amount_required"  type="number" class="form-control" formControlName="salary_amount_required">         
            </div>
          </div>
        </form>
      </div>
      
      <div class="modal-footer mt-5">
        <!-- <button   class="btn btn-warning col-md-4 text-white" (click)="resetForm()">Reset</button> -->
        <button  type="submit"  (click)="create_request()" class="btn site-btn-success col-md-4 text-white">Send Request</button>
      
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div bsModal #editModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header text-white site-btn-success m-0 p-2">
        <h6 class="modal-title">Edit Request</h6>
        <button type="button" class="close btn text-white site-btn-success m-0 p-0" (click)="editModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="editRecordForm" >
          <input type="text"  hidden  name="input-small" class="form-control form-control-md" placeholder="" formControlName="id" required >
          <div class="form-group mb-3">
            <label for="evidence" class="control-label fw-bold">
              Employee No 
            </label>
            <div class="employee_no">
              <input id="employee_no"  type="text" class="form-control" formControlName="employee_no">         
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="evidence" class="control-label fw-bold">
              Position Title 
            </label>
            <div class="position">
              <input id="position"  type="text" class="form-control" formControlName="position">         
            </div>
          </div>
          <div class="form-group mb-3">
            <label class="col-form-label fw-bold" for="purpose">Purpose of Travel</label>
            <div class="">
              <ng-select formControlName="purpose" placeholder="-- select below --">
                <ng-option value="Business">Business</ng-option>
                <ng-option value="Training">Training</ng-option>
                <ng-option value="Personal">Personal</ng-option>
              </ng-select>
            </div>
          </div>
          <div class="form-group mb-3">
            <label class="col-form-label fw-bold" for="input-small">Travel Description / Details</label>
            <div class="">
              <textarea rows="3"  class="form-control form-control-md" placeholder="Type here..."  formControlName="description" required ></textarea>
            </div>
          </div>
          <div class="form-group mb-3">
            <label class="col-form-label fw-bold" for="route">Travel Route</label>
            <div class="">
              <textarea rows="3"  class="form-control form-control-md" placeholder="Type here..."  formControlName="route" required ></textarea>
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="departure_date" class="control-label fw-bold">
              Departure Date 
            </label>
            <div class="position">
              <input id="departure_date"  type="date" class="form-control" formControlName="departure_date">         
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="return_date" class="control-label fw-bold">
              Return Date 
            </label>
            <div class="position">
              <input id="return_date"  type="date" class="form-control" formControlName="return_date">         
            </div>
          </div>
          
          <div class="form-group mb-3">
            <label class="col-form-label fw-bold" for="input-small">Hotel / Accommodation</label>
            <div class="">
              <ng-select formControlName="accommodation" placeholder="-- select below --">
                <ng-option [value]="true">Yes</ng-option>
                <ng-option [value]="false">No</ng-option>
              </ng-select>
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="visa_required_date" class="control-label fw-bold">
              Required Date of Visa. <mark>If Applicable</mark> 
            </label>
            <div class="position">
              <input id="visa_required_date"  type="date" class="form-control" formControlName="visa_required_date">         
            </div>
          </div>
        </form>
      </div>
        
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary text-white" (click)="editModal.hide()">Close</button>
        <button type="button" class="btn site-btn-success text-white" (click)="saveEditChanges()">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div class="animated fadeIn mb-4" *ngxPermissionsExcept="['USER']">
  <div class="card">
    <div class="card-header site-btn-success-dark">
      <strong>Salary Advance Requests</strong>
      <!-- <span class="pointer float-end text-white" (click)="back_btn()">
        <span class="fa fa-arrow-left   " ></span> &nbsp;<b>Back</b> 
     </span> -->
     
     <!-- <span class="pointer float-end text-white " (click)="createModal.show()">
          <span class="fw-bold"><i class="fa fa-plus" ></i> Add New</span>
      </span> -->
    </div>
    <!-- <div class="my-2" *ngxPermissionsExcept="['VIEWER']">
      <button type="button" class="btn btn-block site-btn-success text-white col-sm-4 col-md-4 col-lg-2 float-end" (click)="createModal.show()">
        <i class="fa fa-plus"></i> Add New</button>
    </div> -->
    <div class="card-body">
      <div class="table-responsive">
        <div class="float-en mb-3 mt-2 pt-0">
          <input type="text" [(ngModel)]="searchString" placeholder="Search..." class="my-0">
        </div>
        <table class="table table-striped table-bordered table-hover row-border  pt-0 mb-3" >
          <thead class="mt-0">
            <tr>
              <th>Travel ID</th>
              <th>Employee</th>
              <th *ngIf="recordinstance?.requesting_for == 'INDIVIDUAL'">Employee No</th>
              <th>Department</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Date Requested</th>
              <th *ngxPermissionsExcept="['VIEWER']">
                Action
              </th>
            </tr>
          </thead>
          <tbody>
              <tr *ngFor="let recordinstance of records?.results | filter : searchString; let i = index">
              <td>{{ recordinstance?.tid }}</td>   
              <td>
                <span *ngIf="recordinstance?.requesting_for == 'INDIVIDUAL'">
                  {{ recordinstance?.traveler?.first_name }} {{ recordinstance?.traveler?.last_name }}
                </span>
                <span *ngIf="recordinstance?.requesting_for == 'OTHERS'">
                  <div class="container">
                    <table class="wikitable" width="100%">
                      <thead>
                        <tr>
                          <th>#</th>
                          <th>Employee</th>
                          <th>Number</th>
                          <th>Amount</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let item of recordinstance?.advance_requests; let i = index">
                          <td width="5%">{{i+1}}</td>
                          <td>{{item?.employee_name}}</td>
                          <td>{{item?.employee_no}}</td>
                          <td>{{item?.amount | currency:"KES "}}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </span>
              </td>   
              <td *ngIf="recordinstance?.requesting_for == 'INDIVIDUAL'">{{ recordinstance?.employee_no }}</td>   
              <td>{{ recordinstance?.department?.name }}</td>   
              <td>{{ recordinstance?.salary_advance?.amount | currency:'KES '}}</td>     
              <td>
                <span *ngIf="recordinstance?.salary_advance?.status == 'REQUESTED'" class="badge bg-primary">REQUESTED</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'APPROVED'" class="badge bg-success">APPROVED</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'CLOSED'" class="badge bg-success">CLOSED</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'REJECTED'" class="badge bg-danger">REJECTED</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'INCOMPLETE'" class="badge bg-warning">INCOMPLETE</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'ASSIGNED'" class="badge bg-info">ASSIGNED</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'RESUBMITTED'" class="badge bg-purple">RESUBMITTED</span>
              </td>   
              <td>{{ recordinstance?.date_created | date}}</td>         
              <td *ngxPermissionsExcept="['VIEWER']" class="text-nowrap">
  
                    <div ngbDropdown container="body">
                      <button type="button" class="btn btn-outline-primary btn-sm" ngbDropdownToggle>Actions</button>
                      <div ngbDropdownMenu>
                        <button ngbDropdownItem (click)="view_request(recordinstance?.id)">View Trip</button>
                        <!-- <button ngbDropdownItem *ngIf="recordinstance?.status == 'ASSIGNED' || recordinstance?.status == 'RESUBMITTED'" (click)="closeModal.show(); set_request_id(recordinstance?.id)">Process</button> -->
                        <!-- <span *ngxPermissionsOnly="['MMD','USER_MANAGER']">
                          <button ngbDropdownItem *ngIf="recordinstance?.status == 'ASSIGNED' || recordinstance?.status == 'RESUBMITTED'" (click)="update_quote_status('REJECTED', recordinstance?.id)">Reject</button>
                          <button ngbDropdownItem *ngIf="recordinstance?.status == 'ASSIGNED' || recordinstance?.status == 'RESUBMITTED'" (click)="update_quote_status('INCOMPLETE', recordinstance?.id)">Is Incomplete</button>
                        </span> -->
                        
                        <span *ngxPermissionsOnly="['HOF','USER_MANAGER']">
                          <div class="dropdown-divider"></div>
                          <button ngbDropdownItem (click)="update_salary_status('APPROVED', recordinstance?.salary_advance?.id)" [disabled]="recordinstance?.salary_advance?.status != 'REQUESTED'">Approve</button>
                          <button ngbDropdownItem (click)="update_salary_status('REJECTED', recordinstance?.salary_advance?.id)" [disabled]="recordinstance?.salary_advance?.status != 'REQUESTED'">Reject</button>
                        </span>
                        
                        <span *ngxPermissionsOnly="['USER','USER_MANAGER']">
                          <button ngbDropdownItem (click)="editRecord(i)" [disabled]="recordinstance?.status != 'REQUESTED' && recordinstance?.status != 'INCOMPLETE'">Edit</button>
                          <div class="dropdown-divider"></div>
                          <button ngbDropdownItem (click)="deleteInstanceRecord(recordinstance?.id)" [disabled]="recordinstance?.status != 'REQUESTED'">Delete</button>
                        </span>
                      </div>
                    </div>
              </td>
            </tr>
          </tbody>
          <tbody *ngIf="records?.count == 0">
            <tr>
              <td colspan="9" class="no-data-available">No data available</td>
            </tr>
          <tbody>
        </table>
        <div *ngIf="records?.count > 50">
          <!-- <p>Default pagination:</p> -->
          <ngb-pagination [collectionSize]="records?.count" [pageSize]="50" [(page)]="page" (pageChange)="getPageFromService($event)" aria-label="Default pagination" class="d-flex justify-content-end"></ngb-pagination>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="animated fadeIn mb-4" *ngxPermissionsOnly="['USER']">
  <div class="card">
    <div class="card-header site-btn-success-dark">
      <strong>Salary Advance Requests</strong>
      <span class="pointer float-end text-white" (click)="back_btn()">
        <span class="fa fa-arrow-left   " ></span> &nbsp;<b>Back</b> 
     </span>
    </div>
    <!-- <div class="mt-3 mx-3" *ngxPermissionsExcept="['VIEWER']">
      <button type="button" class="btn btn-block site-btn-success text-white col-sm-4 col-md-3 col-lg-2" (click)="createModal.show()">
        <i class="fa fa-plus"></i> Add New</button>
        <input type="text" [(ngModel)]="searchString" placeholder="Search..." class="my-0 float-end">
    </div> -->
    <div class="card-body">
      <div class="table-responsive">
        <!-- <div class="float-en mb-3 mt-2 pt-0">
          <input type="text" [(ngModel)]="searchString" placeholder="Search..." class="my-0">
        </div> -->
        <table class="table table-striped table-bordered table-hover row-border  pt-0 mb-3" >
          <thead class="mt-0">
            <tr>
              <th>Travel ID</th>
              <th>Purpose</th>
              <th>Amount Requested</th>
              <th>Status</th>
              <th>Date Requested</th>
              <th *ngxPermissionsExcept="['VIEWER']">
                Action
              </th>
            </tr>
          </thead>
          <tbody>
              <tr *ngFor="let recordinstance of records?.results | filter : searchString; let i = index">
              <td>{{ recordinstance?.tid }}</td>   
              <td>{{ recordinstance?.purpose }}</td>   
              <td>{{ recordinstance?.salary_advance?.amount | currency:'KES '}}</td>   
              <td>
                <span *ngIf="recordinstance?.salary_advance?.status == 'REQUESTED'" class="badge bg-primary">REQUESTED</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'APPROVED'" class="badge bg-success">APPROVED</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'CLOSED'" class="badge bg-success">CLOSED</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'REJECTED'" class="badge bg-danger">REJECTED</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'INCOMPLETE'" class="badge bg-warning">INCOMPLETE</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'ASSIGNED'" class="badge bg-info">ASSIGNED</span>
                <span *ngIf="recordinstance?.salary_advance?.status == 'RESUBMITTED'" class="badge bg-purple">RESUBMITTED</span>
              </td>  
              <td>{{ recordinstance?.salary_advance?.date_created | date}}</td>       
              <td *ngxPermissionsExcept="['VIEWER']" class="text-nowrap">
  
                    <div ngbDropdown container="body">
                      <button type="button" class="btn btn-outline-primary btn-sm" ngbDropdownToggle>Actions</button>
                      <div ngbDropdownMenu>
                        <button ngbDropdownItem (click)="view_request(recordinstance?.id)">View Trip</button>

                        <span *ngxPermissionsOnly="['USER','USER_MANAGER']">
                          <button ngbDropdownItem (click)="editRecord(i)" [disabled]="recordinstance?.status != 'REQUESTED' && recordinstance?.status != 'INCOMPLETE'">Edit</button>
                          <!-- <div class="dropdown-divider"></div>
                          <button ngbDropdownItem (click)="deleteInstanceRecord(recordinstance?.id)" [disabled]="recordinstance?.status != 'REQUESTED'">Delete</button> -->
                        </span>
                      </div>
                    </div>
              </td>
            </tr>
          </tbody>
          <tbody *ngIf="records?.count == 0">
            <tr>
              <td colspan="9" class="no-data-available">No data available</td>
            </tr>
          <tbody>
        </table>
        <div *ngIf="records?.count > 50">
          <!-- <p>Default pagination:</p> -->
          <ngb-pagination [collectionSize]="records?.count" [pageSize]="50" [(page)]="page" (pageChange)="getPageFromService($event)" aria-label="Default pagination" class="d-flex justify-content-end"></ngb-pagination>
        </div>
      </div>
    </div>
  </div>
</div>





